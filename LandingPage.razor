@inject ProductContext productcontext
@inject ISnackbar Snackbar
<MudThemeProvider IsDarkMode="true" />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudMainContent Class="pt-0">
        <MudTabs Elevation="4" Rounded="true" Centered="true" Color="@Color.Primary">
            <MudTabPanel Text="Intro">
                <WpfApp1.RazorFiles.Intro />
            </MudTabPanel>
            <MudTabPanel Text="Show Data" Disabled="!showdata">
                @if (showdata)
                {
                    @if (productcontext.Products.Any())
                    {
                        @foreach (var item in productcontext.Categories)
                        {
                            <MudCard Class="ma-1">
                                <MudCardContent>
                                    <MudText><b>Catagory Name:</b> @item.Name</MudText>

                                    @foreach (var SubItem in item.Products)
                                    {
                                        <MudText Typo="Typo.body2"><b>Product Name:</b> @SubItem.Name</MudText>
                                        <MudText><b>ProductId:</b> @SubItem.ProductId</MudText>
                                        <MudText><b>CategoryId:</b> @SubItem.CategoryId</MudText>
                                    }
                                </MudCardContent>
                            </MudCard>
                        }
                    }
                }
            </MudTabPanel>
            <MudTabPanel Text="THE BUTTON" Disabled="!showdata">
                <MudItem Class="pa-8 ma-8">
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" OnClick="AddRandom">Add Random Data to Database</MudButton>
                </MudItem>
            </MudTabPanel>
            <MudTabPanel Text="New Product">
                <WpfApp1.RazorFiles.Product />
            </MudTabPanel>
            <MudTabPanel Text="New Category" Disabled="!showdata">
                <WpfApp1.RazorFiles.Category />
            </MudTabPanel>
            <MudTabPanel Text="Sales" Disabled="!showdata">
                <WpfApp1.RazorFiles.SalesGraph />
            </MudTabPanel>

            <MudTabPanel Text="Loader" Disabled="!showdata">
                <WpfApp1.RazorFiles.Loader />
            </MudTabPanel>
        </MudTabs>
    </MudMainContent>
</MudLayout>
@code {
    private int currentCount = 0;
    bool showdata;

    protected override async Task OnInitializedAsync()
    {
        await productcontext.Database.EnsureCreatedAsync();

        await AddRandom();
        showdata = true;
    }

    async Task AddRandom()
    {
        Random random = new Random();
        productcontext.Attach(new Product { Name = "Name", CategoryId = random.Next(productcontext.Categories.First().CategoryId, productcontext.Categories.OrderBy(x => x.CategoryId).Last().CategoryId) });
    await productcontext.SaveChangesAsync();
        Snackbar.Add("New Item Added");
    }

}